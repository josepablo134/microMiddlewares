# Middlewares and Drivers

This project holds a simple middleware interface for each common internal peripheral
used in embedded projects for Tiva C. This middlewares were tested on FreeRTOS.

This is work in progress.

The project structure is ment to be imported with CMake as follows:

```.cmake
add_subdirectory( lib/path/microMiddlewares/ )
```

# CPacMan support

This repo is compatible with [cpacman](https://github.com/josepablo134/SimpleSourcePackageManager), a simple package manager (inspired on npm) meant to download source code and integrate it to your project with a simple json file descriptor.

Check it out: [cpacman](https://github.com/josepablo134/SimpleSourcePackageManager)

## Installation

Create a `package.json` file like the following:

```.json
{
  "name": "TivaCTemplate",
  "version": "1.0.0",
  "description": "This is a template",
  "author": "Josepablo C.",
  "license": "ISC",
  "dependencies": [
		{ "name":"microMiddlewares", "uri":"git@github.com:josepablo134/microMiddlewares.git", "type":"git" }
  ]
}
```

After that, invoke `cpacman` right next to the json file:

```.sh
$ cpacman install
```

This will create a `c_modules` folder containing a CMake file required to add the package to the project.

For more information about how cpacman works and how to use it, check out: [cpacman](https://github.com/josepablo134/SimpleSourcePackageManager)

## Integration with CMake

Once installed with cpacman or copied to your project tree. Import to cmake as follows:

 - with cpacman:
```.cmake
# Add folder generated by cpacman
add_subdirectory( ${WORK_DIR}/c_modules )
```

 - cloned to local folder:
```.cmake
# Add microMiddlewares root folder
add_subdirectory( path/to/microMiddlewares )
```

After importing to cmake, just link with the requried libraries or link with all the libraries:

Linking with I2C only:
```.cmake
target_link_libraries( ${COMPONENT_NAME}
		TivaWare
		I2C::TivaCTM4C1294
)
```

Linking with all libraries:
```.cmake
target_link_libraries( ${COMPONENT_NAME}
		TivaWare
		Misc
		System
		I2C::TivaCTM4C1294
		SPI::TivaCTM4C1294
		BUS8080::TivaCTM4C1294
		ILI9341::TivaCTM4C1294
		SSD1306::TivaCTM4C1294
		MCP2515::TivaCTM4C1294
		simpleGFX::TivaCTM4C1294
)
```


# Future work

For now, each driver works using polling. In the next phase it will include an _open_ method with
nonblocking capabilities which uses interrupts per peripheral (if possible).

